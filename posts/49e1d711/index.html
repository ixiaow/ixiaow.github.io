<html>

<head>
    <meta charset="utf-8"/>
<meta name="description" content="心若没有栖息的地方，到哪里都是在流浪"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Paint高级应用---滤镜 | Xiaowu</title>

<link rel="shortcut icon" href="https://jxiaow.gitee.io/favicon.ico?v=1610701443576">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://jxiaow.gitee.io/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">


<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>

<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.8.0/mermaid.min.js"></script>
<script>
    var config = {
        startOnLoad:true,
        flowchart:{
            useMaxWidth:false,
            htmlLabels:true
        }
    };
    mermaid.initialize(config);
    $(function(){
        var elements = document.getElementsByClassName("language-mermaid");
        for (var i = elements.length; i--;) {
            element = elements[i];
            var graphDefinition = element.innerText;
            if (graphDefinition) {
                var svg = mermaid.render('ha_mermaid_' + i, graphDefinition, function(svg){});
                if (svg) {
                    var svgElement = document.createElement('div');
                    preNode = element.parentNode;
                    svgElement.innerHTML = svg;
                    svgElement.setAttribute('class', 'mermaid');
                    svgElement.setAttribute('data-processed', 'true');
                    preNode.parentNode.replaceChild(svgElement, preNode);
                }
            }
        }
    });
</script>
</head>

<body>
    <div class="main gt-bg-theme-color-first">
        <nav class="navbar navbar-expand-lg">
    <a href="/">
        <div class="navbar-brand">
            <img class="user-avatar" src="/images/avatar.png" alt="头像">
            <div class="site-name gt-c-content-color-first">
                Xiaowu
            </div>
        </div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav " style="text-align: center">
            
                <div class="nav-item">
                    
                        <a href="/" class="menu gt-a-link">
                            首页
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/archives" class="menu gt-a-link">
                            归档
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/about" class="menu gt-a-link">
                            关于
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="https://jxiaow.gitee.io/posts/favourite" class="menu gt-a-link">
                            收藏
                        </a>
                    
                </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1610701443576" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>

        <div class="post-container">

            <!-- <div class="post-detail gt-bg-theme-color-second"> -->
            <article style="display:flex;">
                <div class="post-detail gt-bg-theme-color-second gt-post-content">
                    <h2 class="post-title">
                        Paint高级应用---滤镜
                    </h2>
                    <div class="post-info">
                        <div>
                            <time class="post-time gt-c-content-color-first">
                                · 2020-12-21 ·
                            </time>
                            
                            <a href="https://jxiaow.gitee.io/tag/d-l32TBQj/" class="post-tags">
                                # Paint
                            </a>
                            
                            <a href="https://jxiaow.gitee.io/tag/GJLfjss5g/" class="post-tags">
                                # UI
                            </a>
                            
                            <a href="https://jxiaow.gitee.io/tag/f3tbfHeq9/" class="post-tags">
                                # Android
                            </a>
                            
                        </div>
                        <div>
                            
                            <span id="/posts/49e1d711/"
                                class="leancloud_visitors" data-flag-title="Paint高级应用---滤镜">
                                <em class="post-meta-item-text">阅读量 </em>
                                <i class="leancloud-visitors-count">0</i>
                            </span>
                            
                        </div>
                    </div>

                    <!-- <div class="post-content-wrapper"> -->
                    <div class="post-content">
                        <h1 id="滤镜">滤镜</h1>
<p>滤镜其实是对原本的图像颜色进行调整。</p>
<h2 id="图像构成">图像构成</h2>
<p>在一个图像文件中，它保存的数据主要分为两块：<strong>图像的信息</strong>和<strong>图像的数据</strong>。</p>
<p>图像的信息：它是一组让CPU和GPU在显示图像的时候基于这组信息显示的信息。</p>
<p>图像的数据：图像具体显示的像素点数据。</p>
<h3 id="jpg的文件结构">JPG的文件结构</h3>
<figure data-type="image" tabindex="1"><img src="https://cdn.jsdelivr.net/gh/jxiaow/cdn-images@latest/blog-images/2020/12/11/9886e90f014d462b560dcec9c327bdb7-images-4677e1.jpg" alt="images" loading="lazy"></figure>
<p>如上图所示，它的部分16进制如下：</p>
<figure data-type="image" tabindex="2"><img src="https://cdn.jsdelivr.net/gh/jxiaow/cdn-images@latest/blog-images/2020/12/11/57cb6692a312934e96276423baf6e7b7-image-20201211104548456-d59a09.png" alt="image-20201211104548456" loading="lazy"></figure>
<blockquote>
<p>对于一个JPG 文件来说，其文件头总是由位固定的字节来描述的：<br>
十六进制数   FF D8 FF E0 00 10 4A 46 00 01</p>
</blockquote>
<p>具体的格式信息，就不说啦。</p>
<h2 id="颜色通道和颜色模式">颜色通道和颜色模式</h2>
<p><strong>颜色通道：</strong> 保存图像颜色信息的通道称为颜色通道。可以理解为记录色彩信息的那一段数据， 每个图像都有一个或者多个颜色通道，图像中默认的颜色通道信息取决于颜色模式。</p>
<p><strong>颜色模式：</strong> 颜色模式可以理解为是一种将某种颜色表现为数字形式的模型，或者说是一种记录图像颜色的方式。分为：RGB模式、CMYK模式、HSB模式、Lab颜色模式、位图模式、灰度模式、索引颜色模式、双色调模式和多通道模式等。<br>
实际上我们就认为，我要显示的色彩是用数字表示的，最经典的RGB模式我们可以理解为R(255) G(0) B(0) 当前这个像素显示，在识别的时候为红色，他由红 绿 蓝 三种色彩进行混合，显示出我们要的颜色其程度数值是0-255的范围</p>
<p><strong>总结：</strong> 也就是说，其实图像的显示，每个点都是由模式所决定的色彩数值混合形成我们想要的颜色，那么我们的滤镜效果实现，其实实际上就是去对于颜色通道进行过滤操作，在其原本的模式数值上面进行操作，达到更改图像色彩效果的目的，这就是我们所为的滤镜。</p>
<h2 id="颜色矩阵">颜色矩阵</h2>
<p>在Android当中，他所采用的颜色模式是<strong>RGBA模式</strong>，也就是在<strong>红绿蓝</strong>的基础上加入了<strong>Alpha透明度</strong>的概念，那么也就是他现在是一个<strong>四通道的模式</strong>。<br>
在Android当中将图像信息获取出来时候，当前图像的颜色通道信息他用的是一个矩阵在进行保存。</p>
<figure data-type="image" tabindex="3"><img src="https://cdn.jsdelivr.net/gh/jxiaow/cdn-images@latest/blog-images/12625345-aa867504e3102a19.png" alt="img" loading="lazy"></figure>
<p>上面这里看到的是一个四通道形式的表示方式，我门会发现在1-1、2-2、3-3、4-4 的位置都是一个1的数值，那么几个数值我们把他理解为颜色的系数，1为原本数值不动，若0.5那么当前对应的<code>rgba</code>四个选项按比例处理。<br>
如果想要更改为半透明的，那么，当前a的值改为0.5。</p>
<p>但是如果在这种情况下：</p>
<ol>
<li>红色 分量值更改为原来的2倍；</li>
<li>绿色分量增加100；</li>
</ol>
<p>则用4阶矩阵的乘法无法实现，所以应该在四阶色彩变换矩阵上增加一个<strong>亚元坐标</strong>，来实现所列的矩阵运算:</p>
<p>在android当中真正的表现方式他应用了一个4*5的矩阵<br>
<img src="https://cdn.jsdelivr.net/gh/jxiaow/cdn-images@latest/blog-images/2020/12/11/4b8c057fe782d2a8707ca5ea34ce29d2-image-20201211125055945-fce20d.png" alt="image-20201211125055945" loading="lazy"></p>
<p>最后方加入一列，作为所为的<strong>亚元坐标</strong>，其实也就是分量值。</p>
<h2 id="滤镜实现">滤镜实现</h2>
<p>对于矩阵的操作运算，在android中可以依赖一个API就行。</p>
<pre><code class="language-java">// 颜色通道过滤
ColorMatrix colorMartrix = new ColorMatrix(new float[]{
            1, 0,0,0,0,
            0,0,0,0,0,
            0,0,0,0,0,
            0,0,0,1,0,
    });
  paint.setColorFilter(new ColorMatrixColorFilter(colorMartrix));
</code></pre>
<h2 id="滤镜效果">滤镜效果</h2>
<p>下面各个效果，公共代码部分：</p>
<pre><code class="language-kotlin">class FilterView @JvmOverloads constructor(
    context: Context, attrs: AttributeSet? = null, defStyleAttr: Int = 0
) : View(context, attrs, defStyleAttr) {
 
    private val bitmap: Bitmap = BitmapFactory.decodeResource(resources, R.drawable.images)
    private val rectF: RectF = RectF(0f, 0f, bitmap.width.toFloat(), bitmap.height.toFloat())
    private val paint: Paint = Paint()
 
    init {
        setLayerType(LAYER_TYPE_HARDWARE, null) // 开启硬件加速
    }
 
    override fun onDraw(canvas: Canvas) {
        super.onDraw(canvas)
        canvas.translate(width / 4f, 0f)
        paint.reset()
        paint.color = Color.RED
        canvas.drawBitmap(bitmap, null, rectF, paint)
    }
}
</code></pre>
<p>原图：<img src="https://cdn.jsdelivr.net/gh/jxiaow/cdn-images@latest/blog-images/2020/12/11/17e63d86140a396e8fcea1781ca5f1ef-image-20201211144215697-28cedc.png" alt="image-20201211144215697" loading="lazy"></p>
<h3 id="红色">红色</h3>
<figure data-type="image" tabindex="4"><img src="https://cdn.jsdelivr.net/gh/jxiaow/cdn-images@latest/blog-images/2020/12/11/2b45d51e3ef3b1c727bd83be3ed652d5-image-20201211144322349-d38cc7.png" alt="image-20201211144322349" loading="lazy"></figure>
<pre><code class="language-kotlin">// onDraw()：
// 红色系数为1，其余2种系数为0，alpha 系数为1
val colorMartrix = ColorMatrix(
    floatArrayOf(
        1f, 0f, 0f, 0f, 0f,
        0f, 0f, 0f, 0f, 0f,
        0f, 0f, 0f, 0f, 0f,
        0f, 0f, 0f, 1f, 0f,
    )
)
canvas.translate(0f, bitmap.height.toFloat())
paint.colorFilter = ColorMatrixColorFilter(colorMartrix)
canvas.drawBitmap(bitmap, null, rectF, paint)
</code></pre>
<h3 id="绿色加100">绿色加100</h3>
<figure data-type="image" tabindex="5"><img src="https://cdn.jsdelivr.net/gh/jxiaow/cdn-images@latest/blog-images/2020/12/11/246639062180c2b0557e3489a07ef89f-image-20201211144812074-d5c917.png" alt="image-20201211144812074" loading="lazy"></figure>
<pre><code class="language-kotlin">// onDraw()：
// 红、绿、蓝系数为1，绿色分量加100，alpha 系数为1
val colorMartrix = ColorMatrix(
    floatArrayOf(
        1f, 0f, 0f, 0f, 0f,
        0f, 1f, 0f, 0f, 100f,
        0f, 0f, 1f, 0f, 0f,
        0f, 0f, 0f, 1f, 0f,
    )
)
canvas.translate(0f, bitmap.height.toFloat())
paint.colorFilter = ColorMatrixColorFilter(colorMartrix)
canvas.drawBitmap(bitmap, null, rectF, paint)
</code></pre>
<h3 id="底片效果">底片效果</h3>
<figure data-type="image" tabindex="6"><img src="https://cdn.jsdelivr.net/gh/jxiaow/cdn-images@latest/blog-images/2020/12/11/4c99d58a808b2c2a3ad50b327445741d-image-20201211145402759-9aaf00.png" alt="image-20201211145402759" loading="lazy"></figure>
<pre><code class="language-kotlin">// onDraw()：
// 红、绿、蓝系数为-1，分量加255，alpha 系数为1
val colorMartrix = ColorMatrix(
    floatArrayOf(
        -1f, 0f, 0f,  0f, 255f,
        0f, -1f, 0f,  0f, 255f,
        0f, 0f, -1f, 0f,  255f,
        0f, 0f, 0f,  1f, 0f,
    )
)
canvas.translate(0f, bitmap.height.toFloat())
paint.colorFilter = ColorMatrixColorFilter(colorMartrix)
canvas.drawBitmap(bitmap, null, rectF, paint)
</code></pre>
<h3 id="缩放运算-颜色增强">缩放运算-- 颜色增强</h3>
<figure data-type="image" tabindex="7"><img src="https://cdn.jsdelivr.net/gh/jxiaow/cdn-images@latest/blog-images/2020/12/11/4575208b33e9e98ec4dfff3556260dd5-image-20201211150121040-ec7cb3.png" alt="image-20201211150121040" loading="lazy"></figure>
<pre><code class="language-kotlin">// onDraw()：
val colorMartrix = ColorMatrix(
    floatArrayOf(
        1.2f, 0f, 0f, 0f, 0f,
        0f, 1.2f, 0f, 0f, 0f,
        0f, 0f, 1.2f, 0f, 0f,
        0f, 0f, 0f, 1.2f, 0f,
    )
)
canvas.translate(0f, bitmap.height.toFloat())
paint.colorFilter = ColorMatrixColorFilter(colorMartrix)
canvas.drawBitmap(bitmap, null, rectF, paint)
</code></pre>
<h3 id="灰色照片">灰色照片</h3>
<p>去色原理：只要把R G B 三通道的色彩信息设置成一样，那么图像就会变成灰色，同时为了保证图像亮度不变，同一个通道里的R+G+B =1。</p>
<figure data-type="image" tabindex="8"><img src="https://cdn.jsdelivr.net/gh/jxiaow/cdn-images@latest/blog-images/2020/12/11/577782a96dd5ddc8c3af35e015ec93ff-image-20201211153735131-e0d3c4.png" alt="image-20201211153735131" loading="lazy"></figure>
<pre><code class="language-kotlin">// onDraw()：
val colorMartrix =  ColorMatrix(
    floatArrayOf(
        0.213f, 0.715f,0.072f,0f,0f,
        0.213f, 0.715f,0.072f,0f,0f,
        0.213f, 0.715f,0.072f,0f,0f,
        0f,0f,0f,1f,0f,
    ))
canvas.translate(0f, bitmap.height.toFloat())
paint.colorFilter = ColorMatrixColorFilter(colorMartrix)
canvas.drawBitmap(bitmap, null, rectF, paint)
</code></pre>
<h3 id="发色效果">发色效果</h3>
<p>红绿色交换</p>
<figure data-type="image" tabindex="9"><img src="https://cdn.jsdelivr.net/gh/jxiaow/cdn-images@latest/blog-images/2020/12/11/85d0353c94946e4096931c6d1a4fdb13-image-20201211155717814-ede6ee.png" alt="image-20201211155717814" loading="lazy"></figure>
<pre><code class="language-kotlin">// onDraw()：
val colorMartrix = ColorMatrix(
    floatArrayOf(
        0f,1f,0f,0f,0f,
        1f, 0f,0f,0f,0f,
        0f,0f,1f,0f,0f,
        0f,0f,0f,1f,0f,
    ));
canvas.translate(0f, bitmap.height.toFloat())
paint.colorFilter = ColorMatrixColorFilter(colorMartrix)
canvas.drawBitmap(bitmap, null, rectF, paint)
</code></pre>
<h3 id="复古效果">复古效果</h3>
<figure data-type="image" tabindex="10"><img src="https://cdn.jsdelivr.net/gh/jxiaow/cdn-images@latest/blog-images/2020/12/11/fb517bb4dfa14a795a32cc0cff2fefc9-image-20201211160133715-a6f5e8.png" alt="image-20201211160133715" loading="lazy"></figure>
<pre><code class="language-kotlin">// onDraw()：
val colorMartrix = ColorMatrix(
    floatArrayOf(
        1 / 2f, 1 / 2f, 1 / 2f, 0f, 0f,
        1 / 3f, 1 / 3f, 1 / 3f, 0f, 0f,
        1 / 4f, 1 / 4f, 1 / 4f, 0f, 0f,
        0f, 0f, 0f, 1f, 0f,
    )
)
canvas.translate(0f, bitmap.height.toFloat())
paint.colorFilter = ColorMatrixColorFilter(colorMartrix)
canvas.drawBitmap(bitmap, null, rectF, paint)
</code></pre>
<h3 id="颜色通道过滤">颜色通道过滤</h3>
<pre><code class="language-kotlin">// onDraw()：
val colorMartrix = ColorMatrix(
    floatArrayOf(
        1.3F,0,0,0,0,
        0,1.3F,0,0,0,
        0,0,1.3F,0,0,
        0,0,0,1,0,
    )
)
canvas.translate(0f, bitmap.height.toFloat())
paint.colorFilter = ColorMatrixColorFilter(colorMartrix)
canvas.drawBitmap(bitmap, null, rectF, paint)
</code></pre>

                    </div>
                    <div class="essaySuffix-box">
                        <div class="essaySuffix-box-left"><img
                                src="/images/avatar.png" alt="">
                        </div>
                        <div class="essaySuffix-box-right"><span
                                class="essaySuffix-right-title">本文作者</span>：<strong><span style="font-size: 12px;"><a
                                        href="/about"
                                        target="_blank">Xiaowu</a></span></strong> <br><span
                                style="font-weight: bold; white-space:nowrap;">本文链接</span>：<a
                                href="https://jxiaow.gitee.io/posts/49e1d711/"
                                target="_blank">https://jxiaow.gitee.io/posts/49e1d711/</a><br><span
                                class="essaySuffix-right-title">版权声明</span>：本博客所有文章除特别声明外，均采用 <a
                                href="https://creativecommons.org/licenses/by-nc-nd/4.0/" alt="BY-NC-SA"
                                title="BY-NC-SA" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</div>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <!-- </div> -->
                <div class="toc-container">
                    <ul class="markdownIt-TOC">
<li><a href="#%E6%BB%A4%E9%95%9C">滤镜</a>
<ul>
<li><a href="#%E5%9B%BE%E5%83%8F%E6%9E%84%E6%88%90">图像构成</a>
<ul>
<li><a href="#jpg%E7%9A%84%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">JPG的文件结构</a></li>
</ul>
</li>
<li><a href="#%E9%A2%9C%E8%89%B2%E9%80%9A%E9%81%93%E5%92%8C%E9%A2%9C%E8%89%B2%E6%A8%A1%E5%BC%8F">颜色通道和颜色模式</a></li>
<li><a href="#%E9%A2%9C%E8%89%B2%E7%9F%A9%E9%98%B5">颜色矩阵</a></li>
<li><a href="#%E6%BB%A4%E9%95%9C%E5%AE%9E%E7%8E%B0">滤镜实现</a></li>
<li><a href="#%E6%BB%A4%E9%95%9C%E6%95%88%E6%9E%9C">滤镜效果</a>
<ul>
<li><a href="#%E7%BA%A2%E8%89%B2">红色</a></li>
<li><a href="#%E7%BB%BF%E8%89%B2%E5%8A%A0100">绿色加100</a></li>
<li><a href="#%E5%BA%95%E7%89%87%E6%95%88%E6%9E%9C">底片效果</a></li>
<li><a href="#%E7%BC%A9%E6%94%BE%E8%BF%90%E7%AE%97-%E9%A2%9C%E8%89%B2%E5%A2%9E%E5%BC%BA">缩放运算-- 颜色增强</a></li>
<li><a href="#%E7%81%B0%E8%89%B2%E7%85%A7%E7%89%87">灰色照片</a></li>
<li><a href="#%E5%8F%91%E8%89%B2%E6%95%88%E6%9E%9C">发色效果</a></li>
<li><a href="#%E5%A4%8D%E5%8F%A4%E6%95%88%E6%9E%9C">复古效果</a></li>
<li><a href="#%E9%A2%9C%E8%89%B2%E9%80%9A%E9%81%93%E8%BF%87%E6%BB%A4">颜色通道过滤</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                </div>
            </article>
            <!-- </div> -->

          

            

            

            
            <script src='https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js'></script>

<style>
	div#vcomments{
		width:100%;
		max-width: 1000px;
		padding: 2.5%
	}
</style>


	<div id="vcomments"></div>

<script>
	new Valine({
		el: '#vcomments',
		appId: 'CAmH4sFTLPMg3inDkFSqWsuL-gzGzoHsz',
		appKey: '3Mh9SPxWQ7QbJjxmX7EU26z4',
		avatar: 'mp',
		pageSize: 5,
		recordIp: true,
		placeholder: '快来吐槽吧~',
		visitor: true,
	});
</script>

            

            <div class="site-footer gt-c-content-color-first">

  <div class="social-container">

    <a href="https://github.com/jxiaow" target="_blank" title="https://github.com/jxiaow">
      <i class="fab fa-github gt-c-content-color-first"></i>
    </a>

    <a href="https://www.cnblogs.com/xiaowj" target="_blank" title="https://www.cnblogs.com/xiaowj">
      <i class="fas fa-blog gt-c-content-color-first"></i>
    </a>

    <a href="https://blog.csdn.net/xiaowu_zhu" target="_blank" title="https://blog.csdn.net/xiaowu_zhu">
      <i class="fab fa-cuttlefish gt-c-content-color-first"></i>
    </a>

    <a href="mailto:jxiaow@126.com" title="jxiaow@126.com">
      <i class="fas fa-envelope gt-c-content-color-first"></i>
    </a>

  </div>
  <div class="slogan gt-c-content-color-first">心若没有栖息的地方，到哪里都是在流浪</div>
  
  <div>
    <div>
      Theme by <a href="https://github.com/jxiaow/gridea-theme-pure-fashion" target="_blank">jxiaow</a>, Powered by <a
              href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://jxiaow.gitee.io/atom.xml" target="_blank">RSS</a></a>
  </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

            <script>
  let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
  
  if (mainNavLinks == null || mainNavLinks.length == 0) {
    let tocContainer = document.querySelector(".toc-container");
    tocContainer.classList.remove("toc-container")
    // tocContainer.parentElement.firstElementChild.style.width = "100%"
    console.log("隐藏大纲")
  } else {

    // This should probably be throttled.
    // Especially because it triggers during smooth scrolling.
    // https://lodash.com/docs/4.17.10#throttle
    // You could do like...
    // window.addEventListener("scroll", () => {
    //    _.throttle(doThatStuff, 100);
    // });
    // Only not doing it here to keep this Pen dependency-free.


    window.addEventListener("scroll", event => {
      let fromTop = window.scrollY;

      mainNavLinks.forEach((link, index) => {
        let section = document.getElementById(decodeURI(link.hash).substring(1));
        let nextSection = null
        if (mainNavLinks[index + 1]) {
          nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
        }
        if (section.offsetTop <= fromTop) {
          if (nextSection) {
            if (nextSection.offsetTop > fromTop) {
              link.classList.add("current");
            } else {
              link.classList.remove("current");
            }
          } else {
            link.classList.add("current");
          }
        } else {
          link.classList.remove("current");
        }
      });
    });
  }



</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<script>
  let images = document.querySelectorAll("figure > img");
  //   debugger
  //   console.log("dddd: "+ images);
  images.forEach(image => {
    var parent = image.parentElement;
    parent.removeChild(image);
    var aelem = document.createElement('a');
    aelem.href = image.src;
    aelem.dataset['fancybox'] = 'gallery';
    aelem.classList.add('fancybox');
    aelem.appendChild(image);
    parent.appendChild(aelem);
  })

//   <a data-fancybox="gallery" href="big_1.jpg"><img src="small_1.jpg"></a>
// <a data-fancybox="gallery" href="big_2.jpg"><img src="small_2.jpg"></a>
</script>
        </div>
    </div>

</body>

</html>